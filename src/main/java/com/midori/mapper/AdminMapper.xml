<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.midori.mapper.AdminMapper">
	<!-- 홈 -->
	<select id="monthlyTop10Pie" resultType="com.midori.domain.OrderVO">
		<![CDATA[ 
			select rownum, pseq, pname, sales_count 
			from(
			select pseq, pname, sum(quantity) as sales_count 
			from order_view 
			where TO_char(indate, 'YYYYMMDD' ) BETWEEN TO_CHAR(ADD_MONTHS(LAST_DAY(SYSDATE)+1,-1),'YYYYMMDD') AND LAST_DAY(TO_char(sysdate, 'yyyy-MM-dd')) 
			group by pname, pseq 
			order by sales_count desc) 
			where rownum <11
		]]>
	</select>
	<select id="weeklySales" resultType="com.midori.domain.OrderVO"> 
		select * from benefit_view 
		where trunc(indate, 'iw') between TRUNC(sysdate, 'iw') and TRUNC(sysdate, 'iw')+6 
		order by indate
	</select>
	<select id="QnaListNew" resultType="com.midori.domain.QnaVO">
		<![CDATA[ 
			select rownum, ref, qbno, secret, pseq, qtitle, qcontent, qwriter, qregdate, category, 
			abno, atitle, acontent, aregdate, awriter 
			from(select * from qna_view) 
			where rownum <7
		 ]]>
	</select>
	<select id="ReviewListNew" resultType="com.midori.domain.ReviewVO">
		<![CDATA[ 
			select rownum, rbno, pseq, writer, title, content, star, regdate 
			from(
			select * from review order by rbno desc) 
			where rownum <7
		]]>
	</select>


	<!-- 리뷰 -->
	<select id="reviewSelectOne" resultType="com.midori.domain.ReviewVO">
		select * from review where rbno = #{rbno}
	</select>
	
	<update id="reviewModify">
		update review set title = #{title}, content = #{content}, star = #{star} where rbno = #{rbno}
	</update>
	
	<delete id="reviewDelete">
		delete from review where rbno=#{rbno}
	</delete>
	
	<select id="reviewList" resultType="com.midori.domain.ReviewVO">
		select * from review order by rbno desc
	</select>
	
	<!-- 상품문의 -->
	<select id="qnaList" resultType="com.midori.domain.QnaVO">
		select * from qna_view
	</select>
	<select id="getQnaOne" resultType="com.midori.domain.QnaVO">
		select * from qna_view where qbno=#{qbno}
	</select>
	<update id="QuestionModify">
		update question set qtitle=#{qtitle}, qwriter=#{qwriter} , qcontent=#{qcontent}, category=#{category} where qbno = #{qbno} 
	</update>
	<delete id="QuestionDelete">
		delete from question where qbno=#{qbno}
	</delete>
	<insert id="AnswerInsert">
		<selectKey keyProperty="abno" order="BEFORE" resultType="int">
			select answer_seq.nextval from dual
		</selectKey>
			insert into answer(abno, qbno, atitle, acontent, awriter, ref)
			values(#{abno}, #{qbno}, #{atitle}, #{acontent}, #{awriter}, #{ref})
	</insert>
	<update id="updateStatus">
		update question set status=2 where qbno=#{qbno}
	</update>
	<select id="getAnswer" resultType="com.midori.domain.QnaVO">
		select * from answer where abno = #{abno}
	</select>
	<update id="AnswerModify">
		update answer set atitle=#{atitle}, acontent=#{acontent}, awriter=#{awriter} where abno = #{abno}
	</update>
	<delete id="AnswerDelete">
		delete from answer where abno=#{abno}
	</delete>
	<update id="updateStatusDelete">
		update question set status=1 where qbno=#{qbno}
	</update>

	<!-- 주문관리 -->
	<select id="orderList" resultType="com.midori.domain.OrderVO">
		select * from order_view where status=#{status}
	</select>
	<select id="orderDetailList" resultType="com.midori.domain.OrderVO">
		select * from order_view where oseq=#{oseq}
	</select>
	<update id="orderStatusUpdate">
		update orders set status=#{status} where oseq=#{oseq}
	</update>
	<insert id="TrackInsert">
		update orders set track=#{track} where oseq=#{oseq}
	</insert>
	<select id="OrderCount" resultType="int">
		select count(*) from orders where status=#{status}
	</select>
	
	<!-- 통계 -->
	<select id="AllSales" resultType="com.midori.domain.OrderVO">
		<![CDATA[ 
			select rownum, pseq, pname, sales_count 
			from (select pseq ,pname, sum(quantity) as sales_count 
			from order_view 
			group by pname, pseq 
			order by sales_count desc) 
			where rownum <11
		]]>
	</select>
	<select id="TodayBest" resultType="com.midori.domain.OrderVO">
		<![CDATA[
			select rownum, kind, pseq, pname, sales_count 
			from (select p.kind, o.pseq, o.pname, sum(o.quantity) as sales_count 
			from order_view o, product p 
			where o.pseq = p.pseq and TO_CHAR(o.indate, 'YYYYMMDD') = to_char(sysdate, 'yyyymmdd') 
			group by o.pname, o.pseq, p.kind 
			order by sales_count desc) 
			where rownum <6
		 ]]>
	</select>
	<select id="todaySales" resultType="com.midori.domain.OrderVO">
		SELECT * FROM benefit_view 
		WHERE TO_CHAR(indate, 'YYYYMMDD') = to_char(sysdate, 'yyyymmdd') order by indate
	</select>
	<select id="aDayAgoSales" resultType="com.midori.domain.OrderVO">
		SELECT * FROM benefit_view 
		WHERE TO_CHAR(indate, 'YYYYMMDD') = to_char(sysdate-1, 'yyyymmdd') order by indate
	</select>
	<select id="twoDaysAgoSales" resultType="com.midori.domain.OrderVO">
		SELECT * FROM benefit_view 
		WHERE TO_CHAR(indate, 'YYYYMMDD') = to_char(sysdate-2, 'yyyymmdd') order by indate
	</select>
	<select id="thisMonthSales" resultType="com.midori.domain.OrderVO">
		SELECT * FROM benefit_view 
		WHERE TO_char(indate, 'YYYYMMDD' ) BETWEEN TO_CHAR(ADD_MONTHS(LAST_DAY(SYSDATE)+1,-1),'YYYYMMDD') AND 
		LAST_DAY(TO_char(sysdate, 'yyyy-MM-dd')) 
		order by indate
	</select>
	<select id="aMonthAgoSales" resultType="com.midori.domain.OrderVO">
		SELECT * FROM benefit_view 
		WHERE TO_char(indate, 'YYYYMMDD' ) BETWEEN TO_CHAR(ADD_MONTHS(LAST_DAY(SYSDATE)+1,-2),'YYYYMMDD') AND 
		TO_CHAR(ADD_MONTHS(LAST_DAY(SYSDATE),-1),'YYYYMMDD') 
		order by indate
	</select>
	<select id="twoMonthsAgoSales" resultType="com.midori.domain.OrderVO">
		SELECT * FROM benefit_view 
		WHERE TO_char(indate, 'YYYYMMDD' ) BETWEEN TO_CHAR(ADD_MONTHS(LAST_DAY(SYSDATE)+1,-3),'YYYYMMDD') AND 
		TO_CHAR(ADD_MONTHS(LAST_DAY(SYSDATE),-2),'YYYYMMDD') 
		order by indate
	</select>
	<select id="thisYearSales" resultType="com.midori.domain.OrderVO">
		select * from benefit_view 
		where to_char(indate, 'yyyy') =TO_CHAR(SYSDATE, 'YYYY') 
		order by indate
	</select>
	<select id="aYearAgoSales" resultType="com.midori.domain.OrderVO">
		select * from benefit_view 
		where to_number(to_char(indate, 'yyyymmdd')) between to_number(to_char(sysdate,'yyyy')-1)||'0101' 
		and to_number(to_char(sysdate,'yyyy')-1)||'1231' 
		order by indate
	</select>
	<select id="twoYearsAgoSales" resultType="com.midori.domain.OrderVO">
		select * from benefit_view 
		where to_number(to_char(indate, 'yyyymmdd')) between to_number(to_char(sysdate,'yyyy')-2)||'0101' 
		and to_number(to_char(sysdate,'yyyy')-2)||'1231' 
		order by indate
	</select>
</mapper>
